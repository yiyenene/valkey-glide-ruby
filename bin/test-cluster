#!/usr/bin/env bash
set -euo pipefail

echo "ðŸš€ Starting Valkey cluster and app..."
docker compose --profile cluster up -d --wait

cleanup() {
  echo ""
  echo "ðŸ§¹ Cleaning up cluster..."
  docker compose --profile cluster down -v
  echo "âœ… Cleanup complete"
}

trap cleanup EXIT INT TERM

echo "âœ… Cluster is ready"
echo "ðŸ§ª Running cluster tests..."
docker compose exec app bundle exec rake test:cluster

echo "âœ… Tests completed"

